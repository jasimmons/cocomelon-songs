<!DOCTYPE html>
<html lang="en">

<head>
  <title>Cocomelon Song Search</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>

<body style="padding-top:10px">
  <div class="container" style="width:650px">
    <img src="assets/cocomelon-logo.png" class="img-fluid" alt="cocomelon logo">
    <div class="row justify-content-center">
      <div class="col-3 form-floating">
        <select class="form-select" name="season" id="season">
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
          <option value="4">Four</option>
          <option value="5">Five</option>
        </select>
        <label for="season">Season</label>
      </div>
      <div class="col-3 form-floating">
        <select class="form-select" name="episode" id="episode">
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
        </select>
        <label for="episode">Episode</label>
      </div>
    </div>
    <div class="d-flex p-3 justify-content-center">
      <button id="submit" type="button" class="btn btn-primary" style="margin-top:5px;">Submit</button>
    </div>
    <div class="row justify-content-center">
      <div class="col justify-content-center" id="result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var last = {season: undefined, episode: undefined}
    var FUNCTION_API_URL = "%%FUNCTION_API_URL%%";
    //var envAPI = '/songs/list'

    $("#submit").click(function () {
      search()
    })

    function search() {
      var season = $("#season").val().trim()
      var episode = $("#episode").val().trim()
      if (last.season == season && last.episode == episode) {
        return
      }
      last.season = season
      last.episode = episode
      //let API = FUNCTION_API_URL + envAPI
      let src = FUNCTION_API_URL + '?season=' + escape(season) + '&episode=' + escape(episode)

      $.get(src, function (data, status) {
            console.log("status", status)
            var songs = $.parseJSON(data)
            var el = `
<table class="table">
  <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Start Time</th>
    </tr>
  </thead>
  <tbody>
`;
            songs.forEach(function(song, i) {
                  el += `
<tr>
  <th scope="row">${song['name']}</th>
  <th scope="row">${song['start_time']}</th>
</tr>
`;
            });
            el += `
  </tbody>
</table>
`;
            $("#result").html(el)
          })
    }
  </script>
</body>

</html>
